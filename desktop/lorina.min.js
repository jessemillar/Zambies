var l={game:{},debug:{}};
l.game.setup=function(a,b){b&&(document.body.style.background=a);l.dom=document.getElementById("canvas");l.ctx=document.getElementById("canvas").getContext("2d");l.canvas={};l.canvas.width=l.dom.width;l.canvas.height=l.dom.height;window.navigator.vendor?"Google Inc."==window.navigator.vendor&&(l.canvas.agent="chrome"):l.canvas.agent="ejecta";b&&(l.game.fullscreen(),"chrome"==l.canvas.agent&&document.body.setAttribute("onresize","l.game.fullscreen()"));l.object.make("camera",0,0,l.canvas.width,l.canvas.height);
l.entities.camera.color=a;l.entities.camera.previous={};l.entities.camera.previous.x=l.entities.camera.x;l.entities.camera.previous.y=l.entities.camera.y};l.game.fullscreen=function(){l.dom.style.position="absolute";l.dom.style.left="0px";l.dom.style.top="0px";l.dom.width=window.innerWidth;l.dom.height=window.innerHeight;l.canvas&&(l.canvas.width=l.dom.width,l.canvas.height=l.dom.height);l.entities.camera&&(l.entities.camera.width=l.dom.width,l.entities.camera.height=l.dom.height)};
l.game.start=function(){l.game.loop=setInterval(game,1E3/60)};l.game.stop=function(){clearInterval(l.game.loop)};l.camera={};
l.camera.follow=function(a,b,d){l.entities.camera.shaking||(l.entities.camera.following=!0,b&&(l.entities[a].anchor.x<l.entities.camera.x+l.entities.camera.width/2-b/2?l.entities.camera.x=Math.round(l.entities[a].anchor.x-l.entities.camera.width/2+b/2):l.entities[a].anchor.x>l.entities.camera.x+l.entities.camera.width/2+b/2&&(l.entities.camera.x=Math.round(l.entities[a].anchor.x-l.entities.camera.width/2-b/2))),d&&(l.entities[a].anchor.y<l.entities.camera.y+l.entities.camera.height/2-d/2?l.entities.camera.y=
Math.round(l.entities[a].anchor.y-l.entities.camera.height/2+d/2):l.entities[a].anchor.y>l.entities.camera.y+l.entities.camera.height/2+d/2&&(l.entities.camera.y=Math.round(l.entities[a].anchor.y-l.entities.camera.height/2-d/2))),0>l.entities.camera.x?l.entities.camera.x=0:l.entities.camera.x>l.canvas.width-l.entities.camera.width&&(l.entities.camera.x=l.canvas.width-l.entities.camera.width),0>l.entities.camera.y?l.entities.camera.y=0:l.entities.camera.y>l.canvas.height-l.entities.camera.height&&
(l.entities.camera.y=l.canvas.height-l.entities.camera.height))};l.camera.reset=function(){l.entities.camera.x=0;l.entities.camera.y=0};
l.camera.shake=function(a,b,d){l.entities.camera.following&&(l.entities.camera.shaking=!0);l.entities.camera.previous.x=l.entities.camera.x;l.entities.camera.previous.y=l.entities.camera.y;for(var c=b/(2*a),e=0;e<2*a;e++)0==e%2?setTimeout(function(){l.entities.camera.x=l.entities.camera.previous.x;l.entities.camera.y=l.entities.camera.previous.y},c*e):setTimeout(function(){var a=Math.round(l.tools.random(0-d/2,d/2)),b=Math.round(l.tools.random(0-d/2,d/2));0<a?l.entities.camera.x+a<l.canvas.width-
l.entities.camera.width&&(l.entities.camera.x+=a):0<l.entities.camera.x-Math.abs(a)&&(l.entities.camera.x-=Math.abs(a));0<b?l.entities.camera.y+b<l.canvas.height-l.entities.camera.height&&(l.entities.camera.y+=b):0<l.entities.camera.y-Math.abs(b)&&(l.entities.camera.y-=Math.abs(b))},c*e);setTimeout(function(){l.entities.camera.following&&(l.entities.camera.shaking=!1)},b)};l.tool={};l.tool.random=function(a,b){return Math.random()*(b-a)+a};l.tool.count={};
l.tool.count.prototype=function(a){for(var b=Object.keys(l.entities),d=0,c=0;c<b.length;c++)l.entities[b[c]].prototype==a&&d++;return d};l.tool.count.category=function(a){for(var b=Object.keys(l.entities),d=0,c=0;c<b.length;c++)l.entities[b[c]].category==a&&d++;return d};l.tool.measure={};l.tool.measure.x=function(a,b){return l.entities[a]&&l.entities[b]?Math.floor(Math.abs(l.entities[a].anchor.x-l.entities[b].anchor.x)):Math.floor(Math.abs(l.entities[a].anchor.x-b))};
l.tool.measure.y=function(a,b){return l.entities[a]&&l.entities[b]?Math.floor(Math.abs(l.entities[a].anchor.y-l.entities[b].anchor.y)):Math.floor(Math.abs(l.entities[a].anchor.y-b))};l.tool.measure.total=function(a,b,d){if(l.entities[a]&&l.entities[b]){var c=l.tool.measure.x(a,b);a=l.tool.measure.y(a,b)}else c=l.tool.measure.x(a,b),a=l.tool.measure.y(a,d);return Math.floor(Math.sqrt(c*c+a*a))};l.audio={};l.audio.files={};l.audio.make=function(a,b){l.preloader.queue();l.audio.files[a]=document.createElement("audio");l.audio.files[a].src=b;l.audio.files[a].canPlay=!0;"ejecta"==l.canvas.agent?(l.audio.files[a].preload=!0,l.audio.files[a].load(),document.body.appendChild(l.audio.files[a]),l.audio.files[a].addEventListener("canplaythrough",function(){l.preloader.update()})):(l.audio.files[a].setAttribute("preload","auto"),l.audio.files[a].onloadeddata=function(){l.preloader.update()})};
l.audio.pause=function(a){l.audio.files[a].pause()};l.audio.rewind=function(a){l.audio.files[a].canPlay=!0};l.audio.play=function(a){l.audio.files[a].canPlay&&("chrome"==l.canvas.agent&&l.audio.files[a].load(),l.audio.files[a].play(),l.audio.files[a].canPlay=!1)};
l.audio.loop=function(a){l.audio.files[a].canPlay&&("chrome"==l.canvas.agent&&l.audio.files[a].load(),l.audio.files[a].addEventListener("ended",function(){l.audio.files[a].currentTime=0;l.audio.files[a].play()},!1),l.audio.files[a].play(),l.audio.files[a].canPlay=!1)};l.entities={};l.object={};l.object.latest={};
l.object.from=function(a,b,d){l.object.latest[a]||(l.object.latest[a]=0);var c=l.object.latest[a]+1;l.object.latest[a]=c;l.prototype.entities[a]&&(l.entities[a+c]={},l.entities[a+c].prototype=a,l.entities[a+c].x=b-l.prototype.entities[a].anchor.offset.x,l.entities[a+c].y=d-l.prototype.entities[a].anchor.offset.y,l.entities[a+c].width=l.prototype.entities[a].width,l.entities[a+c].height=l.prototype.entities[a].height,l.entities[a+c].bounding={},l.entities[a+c].bounding.x=b,l.entities[a+c].bounding.y=
d,l.entities[a+c].bounding.offset={},l.entities[a+c].bounding.offset.x=l.prototype.entities[a].bounding.offset.x,l.entities[a+c].bounding.offset.y=l.prototype.entities[a].bounding.offset.y,l.entities[a+c].bounding.width=l.prototype.entities[a].width,l.entities[a+c].bounding.height=l.prototype.entities[a].height,l.entities[a+c].anchor={},l.entities[a+c].anchor.offset={},l.entities[a+c].anchor.offset.x=l.prototype.entities[a].anchor.offset.x,l.entities[a+c].anchor.offset.y=l.prototype.entities[a].anchor.offset.y,
l.entities[a+c].anchor.x=b,l.entities[a+c].anchor.y=d,l.entities[a+c].physics={},l.entities[a+c].physics.momentum={},l.entities[a+c].physics.momentum.x=l.prototype.entities[a].physics.momentum.x,l.entities[a+c].physics.momentum.y=l.prototype.entities[a].physics.momentum.y,l.entities[a+c].physics.momentum.total=l.prototype.entities[a].physics.momentum.total,l.prototype.entities[a].category&&(l.entities[a+c].category=l.prototype.entities[a].category),l.prototype.entities[a].sprite&&(l.entities[a+c].sprite=
l.prototype.entities[a].sprite),l.prototype.entities[a].animate&&(l.entities[a+c].animate={},l.entities[a+c].animate.width=l.prototype.entities[a].animate.width,l.entities[a+c].animate.height=l.prototype.entities[a].animate.height,l.entities[a+c].animate.count=l.prototype.entities[a].animate.count,l.entities[a+c].animate.frame=l.prototype.entities[a].animate.frame,l.prototype.entities[a].animate.timer&&(l.prototype.entities[a].animate.interval=l.object.animate(a,timer))))};
l.object["delete"]=function(a){if(l.entities[a])delete l.entities[a];else for(var b=Object.keys(l.entities),d=0;d<b.length;d++)l.entities[b[d]].category==a&&l.object["delete"](b[d])};
l.object.make=function(a,b,d,c,e){l.entities[a]={};l.entities[a].x=b;l.entities[a].y=d;l.entities[a].width=c;l.entities[a].height=e;l.entities[a].bounding={};l.entities[a].bounding.x=b;l.entities[a].bounding.y=d;l.entities[a].bounding.offset={};l.entities[a].bounding.offset.x=0;l.entities[a].bounding.offset.y=0;l.entities[a].bounding.width=c;l.entities[a].bounding.height=e;l.entities[a].anchor={};l.entities[a].anchor.offset={};l.entities[a].anchor.offset.x=c/2;l.entities[a].anchor.offset.y=e/2;l.entities[a].anchor.x=
b+c/2;l.entities[a].anchor.y=d+e/2;l.entities[a].physics={};l.entities[a].physics.momentum={};l.entities[a].physics.momentum.x=0;l.entities[a].physics.momentum.y=0;l.entities[a].physics.momentum.total=0};l.object.categorize=function(a,b){l.entities[a].category=b};
l.object.sprite=function(a,b,d,c,e,f){l.preloader.queue();l.entities[a].sprite=new Image;l.entities[a].sprite.src=b;l.entities[a].animate={};l.entities[a].animate.width=d?d:l.entities[a].width;l.entities[a].animate.height=c?c:l.entities[a].height;e&&(l.entities[a].animate.count=e,l.entities[a].animate.frame=0);f&&(l.entities[a].animate.interval=l.object.animate(a,f));l.entities[a].sprite.onload=function(){l.preloader.update()}};
l.object.animate=function(a,b){setInterval(function(){l.entities[a].animate.frame=l.entities[a].animate.frame<l.entities[a].animate.count-1?l.entities[a].animate.frame+1:0},b)};l.object.anchor=function(a,b,d){l.entities[a].x-=b;l.entities[a].y-=d;l.entities[a].anchor.offset.x=b;l.entities[a].anchor.offset.y=d;l.object.update(a)};l.object.bounding=function(a,b,d,c,e){l.entities[a].bounding.offset.x=b;l.entities[a].bounding.offset.y=d;l.entities[a].bounding.width=c;l.entities[a].bounding.height=e;l.object.update(a)};
l.object.update=function(a){l.entities[a].anchor.x=l.entities[a].x+l.entities[a].anchor.offset.x;l.entities[a].anchor.y=l.entities[a].y+l.entities[a].anchor.offset.y;l.entities[a].bounding.x=l.entities[a].x+l.entities[a].bounding.offset.x;l.entities[a].bounding.y=l.entities[a].y+l.entities[a].bounding.offset.y};l.prototype={};l.prototype.entities={};
l.prototype.make=function(a,b,d){l.prototype.entities[a]={};l.prototype.entities[a].width=b;l.prototype.entities[a].height=d;l.prototype.entities[a].bounding={};l.prototype.entities[a].bounding.x=0;l.prototype.entities[a].bounding.y=0;l.prototype.entities[a].bounding.offset={};l.prototype.entities[a].bounding.offset.x=0;l.prototype.entities[a].bounding.offset.y=0;l.prototype.entities[a].bounding.width=b;l.prototype.entities[a].bounding.height=d;l.prototype.entities[a].anchor={};l.prototype.entities[a].anchor.offset=
{};l.prototype.entities[a].anchor.offset.x=b/2;l.prototype.entities[a].anchor.offset.y=d/2;l.prototype.entities[a].anchor.x=b/2;l.prototype.entities[a].anchor.y=d/2;l.prototype.entities[a].physics={};l.prototype.entities[a].physics.momentum={};l.prototype.entities[a].physics.momentum.x=0;l.prototype.entities[a].physics.momentum.y=0;l.prototype.entities[a].physics.momentum.total=0};l.prototype.categorize=function(a,b){l.prototype.entities[a].category=b};
l.prototype.sprite=function(a,b,d,c,e,f){l.preloader.queue();l.prototype.entities[a].sprite=new Image;l.prototype.entities[a].sprite.src=b;l.prototype.entities[a].animate={};l.prototype.entities[a].animate.width=d?d:l.prototype.entities[a].width;l.prototype.entities[a].animate.height=c?c:l.prototype.entities[a].height;e&&(l.prototype.entities[a].animate.count=e,l.prototype.entities[a].animate.frame=0);f&&(l.prototype.entities[a].animate.timer=f);l.prototype.entities[a].sprite.onload=function(){l.preloader.update()}};
l.prototype.anchor=function(a,b,d){l.prototype.entities[a].x-=b;l.prototype.entities[a].y-=d;l.prototype.entities[a].anchor.offset.x=b;l.prototype.entities[a].anchor.offset.y=d;l.prototype.update(a)};l.prototype.bounding=function(a,b,d,c,e){l.prototype.entities[a].bounding.offset.x=b;l.prototype.entities[a].bounding.offset.y=d;l.prototype.entities[a].bounding.width=c;l.prototype.entities[a].bounding.height=e;l.prototype.update(a)};
l.prototype.update=function(a){l.prototype.entities[a].anchor.x=l.prototype.entities[a].anchor.offset.x;l.prototype.entities[a].anchor.y=l.prototype.entities[a].anchor.offset.y;l.prototype.entities[a].bounding.x=l.prototype.entities[a].bounding.offset.x;l.prototype.entities[a].bounding.y=l.prototype.entities[a].bounding.offset.y};l.buffer={};l.buffer.database=[];l.buffer.object=function(a,b){if(l.entities[a]){var d={};d.name=a;d.y=l.entities[a].anchor.y;d.flipped=b;l.buffer.database.push(d)}else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.buffer.object(d[c],b)};l.draw={};l.draw.blank=function(a){l.ctx.fillStyle=a?a:l.entities.camera.color;l.ctx.fillRect(0,0,l.entities.camera.width,l.entities.camera.height)};
l.draw.rectangle=function(a,b,d,c,e,f){Math.round(a+d)>Math.round(l.entities.camera.x)&&Math.round(a)<Math.round(l.entities.camera.x+l.entities.camera.width)&&Math.round(b+c)>Math.round(l.entities.camera.y)&&Math.round(b)<Math.round(l.entities.camera.y+l.entities.camera.height)&&(f&&(l.ctx.globalAlpha=f),l.ctx.fillStyle=e,l.ctx.fillRect(Math.round(a-l.entities.camera.x),Math.round(b-l.entities.camera.y),d,c),f&&(l.ctx.globalAlpha=1))};
l.draw.objects=function(){l.buffer.database.sort(function(a,d){return a.y-d.y});for(var a=0;a<l.buffer.database.length;a++)Math.round(l.entities[l.buffer.database[a].name].x+l.entities[l.buffer.database[a].name].width)>Math.round(l.entities.camera.x)&&Math.round(l.entities[l.buffer.database[a].name].x)<Math.round(l.entities.camera.x+l.entities.camera.width)&&Math.round(l.entities[l.buffer.database[a].name].y+l.entities[l.buffer.database[a].name].height)>Math.round(l.entities.camera.y)&&Math.round(l.entities[l.buffer.database[a].name].y)<
Math.round(l.entities.camera.y+l.entities.camera.height)&&(l.buffer.database[a].flipped?(l.ctx.save(),"horizontal"==l.buffer.database[a].flipped?(l.ctx.translate(Math.round(l.entities[l.buffer.database[a].name].x+l.entities[l.buffer.database[a].name].width-l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y-l.entities.camera.y)),l.ctx.scale(-1,1)):"vertical"==l.buffer.database[a].flipped?(l.ctx.translate(Math.round(l.entities[l.buffer.database[a].name].x-l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y+
l.entities[l.buffer.database[a].name].height-l.entities.camera.y)),l.ctx.scale(1,-1)):"both"==l.buffer.database[a].flipped&&(l.ctx.translate(Math.round(l.entities[l.buffer.database[a].name].x+l.entities[l.buffer.database[a].name].width-l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y+l.entities[l.buffer.database[a].name].height-l.entities.camera.y)),l.ctx.scale(-1,-1)),l.entities[l.buffer.database[a].name].animate.count?l.ctx.drawImage(l.entities[l.buffer.database[a].name].sprite,
l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count*l.entities[l.buffer.database[a].name].animate.frame,0,l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count,l.entities[l.buffer.database[a].name].animate.height,0,0,l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count,l.entities[l.buffer.database[a].name].animate.height):l.ctx.drawImage(l.entities[l.buffer.database[a].name].sprite,
0,0),l.ctx.restore()):l.entities[l.buffer.database[a].name].animate.count?l.ctx.drawImage(l.entities[l.buffer.database[a].name].sprite,l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count*l.entities[l.buffer.database[a].name].animate.frame,0,l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count,l.entities[l.buffer.database[a].name].animate.height,Math.round(l.entities[l.buffer.database[a].name].x-
l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y-l.entities.camera.y),l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count,l.entities[l.buffer.database[a].name].animate.height):l.ctx.drawImage(l.entities[l.buffer.database[a].name].sprite,Math.round(l.entities[l.buffer.database[a].name].x-l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y-l.entities.camera.y)),(l.debug.anchor||l.debug.all)&&l.draw.rectangle(l.entities[l.buffer.database[a].name].anchor.x,
l.entities[l.buffer.database[a].name].anchor.y,1,1,"#ffff00"),(l.debug.bounding||l.debug.all)&&l.draw.rectangle(l.entities[l.buffer.database[a].name].x+l.entities[l.buffer.database[a].name].bounding.offset.x,l.entities[l.buffer.database[a].name].y+l.entities[l.buffer.database[a].name].bounding.offset.y,l.entities[l.buffer.database[a].name].bounding.width,l.entities[l.buffer.database[a].name].bounding.height,"#00ff00",0.5),(l.debug.names||l.debug.all)&&l.text.write(name,l.entities[l.buffer.database[a].name].x+
l.entities[l.buffer.database[a].name].width,l.entities[l.buffer.database[a].name].y,"#ff0000"),(l.debug.position||l.debug.all)&&l.draw.rectangle(l.entities[l.buffer.database[a].name].x,l.entities[l.buffer.database[a].name].y,1,1,"#0000ff"));l.buffer.database.length=0};
l.draw.hud=function(a,b){if(l.entities[a])b?(l.ctx.save(),"horizontal"==b?(l.ctx.translate(Math.round(l.entities[a].x+l.entities[a].width),Math.round(l.entities[a].y)),l.ctx.scale(-1,1)):"vertical"==b?(l.ctx.translate(Math.round(l.entities[a].x),Math.round(l.entities[a].y+l.entities[a].height)),l.ctx.scale(1,-1)):"both"==b&&(l.ctx.translate(Math.round(l.entities[a].x+l.entities[a].width),Math.round(l.entities[a].y+l.entities[a].height)),l.ctx.scale(-1,-1)),l.entities[a].animate.count?l.ctx.drawImage(l.entities[a].sprite,
l.entities[a].animate.width/l.entities[a].animate.count*l.entities[a].animate.frame,0,l.entities[a].animate.width/l.entities[a].animate.count,l.entities[a].animate.height,0,0,l.entities[a].animate.width/l.entities[a].animate.count,l.entities[a].animate.height):l.ctx.drawImage(l.entities[a].sprite,0,0),l.ctx.restore()):l.entities[a].animate.count?l.ctx.drawImage(l.entities[a].sprite,l.entities[a].animate.width/l.entities[a].animate.count*l.entities[a].animate.frame,0,l.entities[a].animate.width/l.entities[a].animate.count,
l.entities[a].animate.height,Math.round(l.entities[a].x),Math.round(l.entities[a].y),l.entities[a].animate.width/l.entities[a].animate.count,l.entities[a].animate.height):l.ctx.drawImage(l.entities[a].sprite,Math.round(l.entities[a].x),Math.round(l.entities[a].y));else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.draw.hud(d[c],b)};l.preloader={};l.preloader.calculate=function(){l.preloader.percent=Math.round(100*(1-l.preloader.count/l.preloader.total))};l.preloader.queue=function(){l.game.state="loading";l.preloader.count?(l.preloader.total+=1,l.preloader.count+=1):(l.preloader.total=1,l.preloader.count=1);l.preloader.calculate()};l.preloader.update=function(){l.preloader.count-=1;l.preloader.calculate();0==l.preloader.count&&(l.game.state="menu")};l.write={};l.write.hud=function(a,b,d,c,e,f,g){l.ctx.fillStyle=f?f:"#000000";c&&(l.ctx.font=(e+"px "+c).toString());g?"left"==g?l.ctx.textAlign="left":"right"==g?l.ctx.textAlign="right":"center"==g&&(l.ctx.textAlign="center"):l.ctx.textAlign="left";e?l.ctx.fillText(a,b,d+e):l.ctx.fillText(a,b,d+10)};
l.write.text=function(a,b,d,c,e,f,g){l.ctx.fillStyle=f?f:"#000000";c&&(l.ctx.font=(e+"px "+c).toString());g?"left"==g?l.ctx.textAlign="left":"right"==g?l.ctx.textAlign="right":"center"==g&&(l.ctx.textAlign="center"):l.ctx.textAlign="left";e?l.ctx.fillText(a,b-l.entities.camera.x,d+e-l.entities.camera.y):l.ctx.fillText(a,b-l.entities.camera.x,d+10-l.entities.camera.y)};l.collision=function(a,b,d){if(l.entities[a]&&l.entities[b])if(l.entities[a].bounding.x<l.entities[b].bounding.x+l.entities[b].bounding.width&&l.entities[a].bounding.x+l.entities[a].bounding.width>l.entities[b].bounding.x)if(l.entities[a].bounding.y<l.entities[b].bounding.y+l.entities[b].bounding.height&&l.entities[a].bounding.y+l.entities[a].bounding.height>l.entities[b].bounding.y)if(d)eval(d);else return!0;else return!1;else return!1;else if(l.entities[a])for(var c=Object.keys(l.entities),e=0;e<
c.length;e++)l.entities[c[e]].category==b&&l.collision(a,c[e],d);else if(l.entities[b])for(c=Object.keys(l.entities),e=0;e<c.length;e++)l.entities[c[e]].category==b&&l.collision(c[e],b,d);else for(c=Object.keys(l.entities),e=0;e<l.tool.count.category(a);e++)for(var f=0;f<c.length;f++)if(l.entities[c[f]].category==a)for(var g=0;g<c.length;g++)l.entities[c[g]].category==b&&(l.collision(c[f],c[g],d),c=Object.keys(l.entities))};l.move={};l.move.snap=function(a,b,d){if(l.entities[a])l.entities[a].x=l.entities[a].anchor.offset.x?b-l.entities[a].anchor.offset.x:b,l.entities[a].y=l.entities[a].anchor.offset.y?d-l.entities[a].anchor.offset.y:d,l.object.update(a);else for(var c=Object.keys(l.entities),e=0;e<c.length;e++)l.entities[c[e]].category==a&&l.move.snap(c[e],b,d)};
l.move.up=function(a,b){if(l.entities[a])l.entities[a].y-=b/60,l.object.update(a);else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.move.up(d[c],b)};l.move.down=function(a,b){if(l.entities[a])l.entities[a].y+=b/60,l.object.update(a);else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.move.down(d[c],b)};
l.move.left=function(a,b){if(l.entities[a])l.entities[a].x-=b/60,l.object.update(a);else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.move.left(d[c],b)};l.move.right=function(a,b){if(l.entities[a])l.entities[a].x+=b/60,l.object.update(a);else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.move.right(d[c],b)};
l.move.to=function(a,b,d,c){if(l.entities[a]){var e=l.tool.measure.x(a,b)/l.tool.measure.total(a,b,d)*c;c*=l.tool.measure.y(a,d)/l.tool.measure.total(a,b,d);0<l.tool.measure.total(a,b,d)&&(l.entities[a].anchor.x<b&&l.entities[a].anchor.y<d?(l.move.right(a,e),l.move.down(a,c)):l.entities[a].anchor.x>b&&l.entities[a].anchor.y<d?(l.move.left(a,e),l.move.down(a,c)):l.entities[a].anchor.x<b&&l.entities[a].anchor.y>d?(l.move.right(a,e),l.move.up(a,c)):l.entities[a].anchor.x>b&&l.entities[a].anchor.y>d&&
(l.move.left(a,e),l.move.up(a,c)))}else for(var e=Object.keys(l.entities),f=0;f<e.length;f++)l.entities[e[f]].category==a&&l.move.to(e[f],b,d,c)};
l.move.toward=function(a,b,d){if(l.entities[a]){var c=l.tool.measure.x(a,b)/l.tool.measure.total(a,b)*d;d*=l.tool.measure.y(a,b)/l.tool.measure.total(a,b);0<l.tool.measure.total(a,b)&&(l.entities[a].anchor.x<l.entities[b].anchor.x&&l.entities[a].anchor.y<l.entities[b].anchor.y?(l.move.right(a,c),l.move.down(a,d)):l.entities[a].anchor.x>l.entities[b].anchor.x&&l.entities[a].anchor.y<l.entities[b].anchor.y?(l.move.left(a,c),l.move.down(a,d)):l.entities[a].anchor.x<l.entities[b].anchor.x&&l.entities[a].anchor.y>
l.entities[b].anchor.y?(l.move.right(a,c),l.move.up(a,d)):l.entities[a].anchor.x>l.entities[b].anchor.x&&l.entities[a].anchor.y>l.entities[b].anchor.y&&(l.move.left(a,c),l.move.up(a,d)))}else for(var c=Object.keys(l.entities),e=0;e<c.length;e++)l.entities[c[e]].category==a&&l.move.toward(c[e],b,d)};l.physics={};l.game.physics={};
l.physics.update=function(a){if(l.entities[a])l.entities[a].physics.momentum.total=Math.abs(l.entities[a].physics.momentum.x)+Math.abs(l.entities[a].physics.momentum.y),0!==l.entities[a].physics.momentum.x&&(0>l.entities[a].physics.momentum.x?(l.move.left(a,Math.abs(l.entities[a].physics.momentum.x)),l.entities[a].physics.momentum.x+=l.game.physics.friction,0<l.entities[a].physics.momentum.x&&(l.entities[a].physics.momentum.x=0)):0<l.entities[a].physics.momentum.x&&(l.move.right(a,Math.abs(l.entities[a].physics.momentum.x)),
l.entities[a].physics.momentum.x-=l.game.physics.friction,0>l.entities[a].physics.momentum.x&&(l.entities[a].physics.momentum.x=0))),0!==l.entities[a].physics.momentum.y&&(0>l.entities[a].physics.momentum.y?(l.move.up(a,Math.abs(l.entities[a].physics.momentum.y)),l.entities[a].physics.momentum.y+=l.game.physics.friction,0<l.entities[a].physics.momentum.y&&(l.entities[a].physics.momentum.y=0)):0<l.entities[a].physics.momentum.y&&(l.move.down(a,Math.abs(l.entities[a].physics.momentum.y)),l.entities[a].physics.momentum.y-=
l.game.physics.friction,0>l.entities[a].physics.momentum.y&&(l.entities[a].physics.momentum.y=0)));else for(var b=Object.keys(l.entities),d=0;d<b.length;d++)l.entities[b[d]].category==a&&l.physics.update(b[d])};l.physics.friction=function(a){l.game.physics.friction=a};l.physics.momentum={};
l.physics.momentum.stop=function(a){if(l.entities[a])l.entities[a].physics.momentum.x=0,l.entities[a].physics.momentum.y=0;else for(var b=Object.keys(l.entities),d=0;d<b.length;d++)l.entities[b[d]].category==a&&l.physics.momentum.stop(b[d])};l.physics.momentum.transfer=function(a,b){l.entities[b].physics.momentum.x=l.entities[a].physics.momentum.x;l.entities[b].physics.momentum.y=l.entities[a].physics.momentum.y};l.physics.push={};
l.physics.push.up=function(a,b){if(l.entities[a])l.entities[a].physics.momentum.y-=b;else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.physics.push.up(d[c],b)};l.physics.push.down=function(a,b){if(l.entities[a])l.entities[a].physics.momentum.y+=b;else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.physics.push.down(d[c],b)};
l.physics.push.left=function(a,b){if(l.entities[a])l.entities[a].physics.momentum.x-=b;else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.physics.push.left(d[c],b)};l.physics.push.right=function(a,b){if(l.entities[a])l.entities[a].physics.momentum.x+=b;else for(var d=Object.keys(l.entities),c=0;c<d.length;c++)l.entities[d[c]].category==a&&l.physics.push.right(d[c],b)};l.physics.pull={};
l.physics.pull.to=function(a,b,d,c){if(l.entities[a]){var e=l.tool.measure.x(a,b)/l.tool.measure.total(a,b,d)*c;c*=l.tool.measure.y(a,d)/l.tool.measure.total(a,b,d);0<l.tool.measure.total(a,b,d)&&(l.entities[a].anchor.x<b&&l.entities[a].anchor.y<d?(l.physics.push.right(a,e),l.physics.push.down(a,c)):l.entities[a].anchor.x>b&&l.entities[a].anchor.y<d?(l.physics.push.left(a,e),l.physics.push.down(a,c)):l.entities[a].anchor.x<b&&l.entities[a].anchor.y>d?(l.physics.push.right(a,e),l.physics.push.up(a,
c)):l.entities[a].anchor.x>b&&l.entities[a].anchor.y>d&&(l.physics.push.left(a,e),l.physics.push.up(a,c)))}else for(var e=Object.keys(l.entities),f=0;f<e.length;f++)l.entities[e[f]].category==a&&l.physics.pull.to(e[f],b,d,c)};
l.physics.pull.toward=function(a,b,d){if(l.entities[a]){var c=l.tool.measure.x(a,b)/l.tool.measure.total(a,b)*d;d*=l.tool.measure.y(a,b)/l.tool.measure.total(a,b);0<l.tool.measure.total(a,b)&&(l.entities[a].anchor.x<l.entities[b].anchor.x&&l.entities[a].anchor.y<l.entities[b].anchor.y?(l.physics.push.right(a,c),l.physics.push.down(a,d)):l.entities[a].anchor.x>l.entities[b].anchor.x&&l.entities[a].anchor.y<l.entities[b].anchor.y?(l.physics.push.left(a,c),l.physics.push.down(a,d)):l.entities[a].anchor.x<
l.entities[b].anchor.x&&l.entities[a].anchor.y>l.entities[b].anchor.y?(l.physics.push.right(a,c),l.physics.push.up(a,d)):l.entities[a].anchor.x>l.entities[b].anchor.x&&l.entities[a].anchor.y>l.entities[b].anchor.y&&(l.physics.push.left(a,c),l.physics.push.up(a,d)))}else for(var c=Object.keys(l.entities),e=0;e<c.length;e++)l.entities[c[e]].category==a&&l.physics.pull.toward(c[e],b,d)};l.physics.scatter=function(a,b){l.physics.push.up(a,l.tool.random(-b,b));l.physics.push.right(a,l.tool.random(-b,b))};
l.physics.bounce=function(a,b,d,c,e){b||d||c||e||(b=0,d=l.canvas.width,c=0,e=l.canvas.height);if(l.entities[a])l.entities[a].x<=b?(l.entities[a].x=b,l.entities[a].physics.momentum.x=-l.entities[a].physics.momentum.x):l.entities[a].x+l.entities[a].width>=d&&(l.entities[a].x=d-l.entities[a].width,l.entities[a].physics.momentum.x=-l.entities[a].physics.momentum.x),l.entities[a].y<=c?(l.entities[a].y=c,l.entities[a].physics.momentum.y=-l.entities[a].physics.momentum.y):l.entities[a].y+l.entities[a].height>=
e&&(l.entities[a].y=e-l.entities[a].height,l.entities[a].physics.momentum.y=-l.entities[a].physics.momentum.y);else for(var f=Object.keys(l.entities),g=0;g<f.length;g++)l.entities[f[g]].category==a&&l.physics.bounce(f[g],b,d,c,e)};l.keyboard={};l.keyboard.enable=function(){document.body.setAttribute("onkeydown","l.keyboard.pressed(event)");document.body.setAttribute("onkeyup","l.keyboard.cancel(event)")};
l.keyboard.pressed=function(a){27==a.keyCode&&(l.keyboard.escape=!0);32==a.keyCode&&(l.keyboard.space=!0);13==a.keyCode&&(l.keyboard.enter=!0);16==a.keyCode&&(l.keyboard.shift=!0);65==a.keyCode&&(l.keyboard.a=!0);83==a.keyCode&&(l.keyboard.s=!0);38==a.keyCode&&(l.keyboard.up=!0);40==a.keyCode&&(l.keyboard.down=!0);37==a.keyCode&&(l.keyboard.left=!0);39==a.keyCode&&(l.keyboard.right=!0);if(l.debug.keyboard||l.debug.all)l.keyboard.escape&&console.log("Escape"),l.keyboard.space&&console.log("Space"),
l.keyboard.enter&&console.log("Enter"),l.keyboard.shift&&console.log("Shift"),l.keyboard.a&&console.log("A"),l.keyboard.s&&console.log("S"),l.keyboard.up&&console.log("Up"),l.keyboard.down&&console.log("Down"),l.keyboard.left&&console.log("Left"),l.keyboard.right&&console.log("Right")};
l.keyboard.cancel=function(a){27==a.keyCode&&(l.keyboard.escape=!1);32==a.keyCode&&(l.keyboard.space=!1);13==a.keyCode&&(l.keyboard.enter=!1);16==a.keyCode&&(l.keyboard.shift=!1);65==a.keyCode&&(l.keyboard.a=!1);83==a.keyCode&&(l.keyboard.s=!1);38==a.keyCode&&(l.keyboard.up=!1);40==a.keyCode&&(l.keyboard.down=!1);37==a.keyCode&&(l.keyboard.left=!1);39==a.keyCode&&(l.keyboard.right=!1)};
l.keyboard.clear=function(){l.keyboard.escape=!1;l.keyboard.space=!1;l.keyboard.enter=!1;l.keyboard.shift=!1;l.keyboard.a=!1;l.keyboard.s=!1;l.keyboard.up=!1;l.keyboard.down=!1;l.keyboard.left=!1;l.keyboard.right=!1};l.mouse={};l.mouse.clicks={};l.mouse.enable=function(){document.onmousemove=l.mouse.moved;l.dom.setAttribute("onmousedown","l.mouse.clicked(event)");l.dom.setAttribute("onmouseup","l.mouse.cancel()")};l.mouse.moved=function(a){if(a){l.mouse.x=a.clientX-l.dom.offsetLeft+l.entities.camera.x;l.mouse.y=a.clientY-l.dom.offsetTop+l.entities.camera.y;if(0>l.mouse.x||l.mouse.x>l.camera.width||0>l.mouse.y||l.mouse.y>l.camera.height)l.mouse.x=null,l.mouse.y=null;l.mouse.debug()}};
l.mouse.clicked=function(a){a&&(l.mouse.clicked.x=a.x-l.dom.offsetLeft,l.mouse.clicked.y=a.y-l.dom.offsetTop,l.mouse.debug())};l.mouse.cancel=function(a){l.mouse.clicked.x=null;l.mouse.clicked.y=null;l.mouse.debug()};l.mouse.debug=function(){if(l.debug.mouse||l.debug.all)l.mouse.x&&l.mouse.y&&console.log("Mouse at X: "+l.mouse.x+" Y: "+l.mouse.y),l.mouse.clicked.x&&l.mouse.clicked.y&&console.log("Click at X: "+l.mouse.clicked.x+" Y: "+l.mouse.clicked.y)};l.tilt={};l.tilt.x=0;l.tilt.y=0;l.tilt.z=0;l.tilt.enable=function(){document.addEventListener("deviceorientation",function(a){l.tilt.x=a.beta;l.tilt.y=a.alpha;l.tilt.z=a.gamma;l.tilt.debug()},!0)};l.tilt.debug=function(){l.debug.tilt&&console.log("x: "+l.tilt.x+" y: "+l.tilt.y+" z: "+l.tilt.z)};l.touch={};l.touch.database=[];l.touch.enable=function(){document.addEventListener("touchstart",function(a){l.touch.touches(a)});document.addEventListener("touchmove",function(a){l.touch.touches(a)});document.addEventListener("touchend",function(a){l.touch.touches(a)});document.addEventListener("touchcancel",function(a){l.touch.touches(a)})};l.touch.touches=function(a){a?(l.touch.database=a.touches,l.touch.debug()):l.touch.database.length=0};
l.touch.touched=function(a){if(0<l.touch.database.length)for(var b=0;b<l.touch.database.length;b++){if(l.touch.database[b].pageX<l.entities[a].bounding.x+l.entities[a].bounding.width&&l.touch.database[b].pageX>l.entities[a].bounding.x&&l.touch.database[b].pageY<l.entities[a].bounding.y+l.entities[a].bounding.height&&l.touch.database[b].pageY>l.entities[a].bounding.y)return(l.debug.all||l.debug.touches)&&console.log(a+" was touched"),!0;if(b==l.touch.database.length-1)return!1}};
l.touch.debug=function(){if(l.debug.all||l.debug.touches&&0<l.touch.database.length)for(var a=0;a<l.touch.database.length;a++)console.log("X"+a+": "+l.touch.database[a].pageX+" Y"+a+": "+l.touch.database[a].pageY)};