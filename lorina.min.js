var l={game:{},debug:{},screen:{}};l.screen.engine={};
l.game.setup=function(a,b,c,d){l.game.gamecenter=b?!0:!1;l.game.ads=c?!0:!1;d&&(document.body.style.background=a);l.dom=document.getElementById("canvas");l.ctx=document.getElementById("canvas").getContext("2d");l.canvas={};l.canvas.width=l.dom.width;l.canvas.height=l.dom.height;window.navigator.vendor?"Google Inc."==window.navigator.vendor&&(l.canvas.agent="chrome"):l.canvas.agent="ejecta";d&&(l.game.fullscreen(),"chrome"==l.canvas.agent&&document.body.setAttribute("onresize","l.game.fullscreen()"));
l.object.make("camera",0,0,l.canvas.width,l.canvas.height);l.entities.camera.color=a;l.entities.camera.previous={};l.entities.camera.previous.x=l.entities.camera.x;l.entities.camera.previous.y=l.entities.camera.y};
l.game.fullscreen=function(){l.dom.style.position="absolute";l.dom.style.left="0px";l.dom.style.top="0px";l.dom.width=window.innerWidth;l.dom.height=window.innerHeight;l.canvas&&(l.canvas.width=l.dom.width,l.canvas.height=l.dom.height);l.entities.camera&&(l.entities.camera.width=l.dom.width,l.entities.camera.height=l.dom.height)};l.game.start=function(a){l.screen.engine.start=a;l.screen.loading&&l.change.screen("loading");l.preloader.update()};l.game.stop=function(){clearInterval(l.game.loop)};
l.change={};l.change.screen=function(a){clearInterval(l.game.loop);l.game.state=a;l.game.loop=setInterval(l.screen[a],1E3/60)};l.camera={};
l.camera.follow=function(a,b,c){l.entities.camera.shaking||(l.entities.camera.following=!0,b&&(l.entities[a].anchor.x<l.entities.camera.x+l.entities.camera.width/2-b/2?l.entities.camera.x=Math.round(l.entities[a].anchor.x-l.entities.camera.width/2+b/2):l.entities[a].anchor.x>l.entities.camera.x+l.entities.camera.width/2+b/2&&(l.entities.camera.x=Math.round(l.entities[a].anchor.x-l.entities.camera.width/2-b/2))),c&&(l.entities[a].anchor.y<l.entities.camera.y+l.entities.camera.height/2-c/2?l.entities.camera.y=
Math.round(l.entities[a].anchor.y-l.entities.camera.height/2+c/2):l.entities[a].anchor.y>l.entities.camera.y+l.entities.camera.height/2+c/2&&(l.entities.camera.y=Math.round(l.entities[a].anchor.y-l.entities.camera.height/2-c/2))),0>l.entities.camera.x?l.entities.camera.x=0:l.entities.camera.x>l.canvas.width-l.entities.camera.width&&(l.entities.camera.x=l.canvas.width-l.entities.camera.width),0>l.entities.camera.y?l.entities.camera.y=0:l.entities.camera.y>l.canvas.height-l.entities.camera.height&&
(l.entities.camera.y=l.canvas.height-l.entities.camera.height))};l.camera.reset=function(){l.entities.camera.x=0;l.entities.camera.y=0};
l.camera.shake=function(a,b,c){l.entities.camera.following&&(l.entities.camera.shaking=!0);l.entities.camera.previous.x=l.entities.camera.x;l.entities.camera.previous.y=l.entities.camera.y;for(var d=b/(2*a),e=0;e<2*a;e++)0==e%2?setTimeout(function(){l.entities.camera.x=l.entities.camera.previous.x;l.entities.camera.y=l.entities.camera.previous.y},d*e):setTimeout(function(){var a=Math.round(l.tools.random(0-c/2,c/2)),b=Math.round(l.tools.random(0-c/2,c/2));0<a?l.entities.camera.x+a<l.canvas.width-
l.entities.camera.width&&(l.entities.camera.x+=a):0<l.entities.camera.x-Math.abs(a)&&(l.entities.camera.x-=Math.abs(a));0<b?l.entities.camera.y+b<l.canvas.height-l.entities.camera.height&&(l.entities.camera.y+=b):0<l.entities.camera.y-Math.abs(b)&&(l.entities.camera.y-=Math.abs(b))},d*e);setTimeout(function(){l.entities.camera.following&&(l.entities.camera.shaking=!1)},b)};l.audio={};l.audio.files={};l.audio.make=function(a,b){l.preloader.queue();l.audio.files[a]=document.createElement("audio");l.audio.files[a].src=b;l.audio.files[a].canPlay=!0;"ejecta"==l.canvas.agent?(l.audio.files[a].preload=!0,l.audio.files[a].load(),document.body.appendChild(l.audio.files[a]),l.audio.files[a].addEventListener("canplaythrough",function(){l.preloader.update()})):(l.audio.files[a].setAttribute("preload","auto"),l.audio.files[a].onloadeddata=function(){l.preloader.update()})};
l.audio.pause=function(a){l.audio.files[a].pause()};l.audio.rewind=function(a){l.audio.files[a].canPlay=!0};l.audio.play=function(a){l.audio.files[a].canPlay&&!l.audio.mute&&("chrome"==l.canvas.agent&&l.audio.files[a].load(),l.audio.files[a].play(),l.audio.files[a].canPlay=!1)};
l.audio.loop=function(a){l.audio.files[a].canPlay&&!l.audio.mute&&("chrome"==l.canvas.agent&&l.audio.files[a].load(),l.audio.files[a].addEventListener("ended",function(){l.audio.files[a].currentTime=0;l.audio.files[a].play()},!1),l.audio.files[a].play(),l.audio.files[a].canPlay=!1)};l.camera={};
l.camera.follow=function(a,b,c){l.entities.camera.shaking||(l.entities.camera.following=!0,b&&(l.entities[a].anchor.x<l.entities.camera.x+l.entities.camera.width/2-b/2?l.entities.camera.x=Math.round(l.entities[a].anchor.x-l.entities.camera.width/2+b/2):l.entities[a].anchor.x>l.entities.camera.x+l.entities.camera.width/2+b/2&&(l.entities.camera.x=Math.round(l.entities[a].anchor.x-l.entities.camera.width/2-b/2))),c&&(l.entities[a].anchor.y<l.entities.camera.y+l.entities.camera.height/2-c/2?l.entities.camera.y=
Math.round(l.entities[a].anchor.y-l.entities.camera.height/2+c/2):l.entities[a].anchor.y>l.entities.camera.y+l.entities.camera.height/2+c/2&&(l.entities.camera.y=Math.round(l.entities[a].anchor.y-l.entities.camera.height/2-c/2))),0>l.entities.camera.x?l.entities.camera.x=0:l.entities.camera.x>l.canvas.width-l.entities.camera.width&&(l.entities.camera.x=l.canvas.width-l.entities.camera.width),0>l.entities.camera.y?l.entities.camera.y=0:l.entities.camera.y>l.canvas.height-l.entities.camera.height&&
(l.entities.camera.y=l.canvas.height-l.entities.camera.height))};l.camera.reset=function(){l.entities.camera.x=0;l.entities.camera.y=0};
l.camera.shake=function(a,b,c){l.entities.camera.following&&(l.entities.camera.shaking=!0);l.entities.camera.previous.x=l.entities.camera.x;l.entities.camera.previous.y=l.entities.camera.y;for(var d=b/(2*a),e=0;e<2*a;e++)0==e%2?setTimeout(function(){l.entities.camera.x=l.entities.camera.previous.x;l.entities.camera.y=l.entities.camera.previous.y},d*e):setTimeout(function(){var a=Math.round(l.tools.random(0-c/2,c/2)),b=Math.round(l.tools.random(0-c/2,c/2));0<a?l.entities.camera.x+a<l.canvas.width-
l.entities.camera.width&&(l.entities.camera.x+=a):0<l.entities.camera.x-Math.abs(a)&&(l.entities.camera.x-=Math.abs(a));0<b?l.entities.camera.y+b<l.canvas.height-l.entities.camera.height&&(l.entities.camera.y+=b):0<l.entities.camera.y-Math.abs(b)&&(l.entities.camera.y-=Math.abs(b))},d*e);setTimeout(function(){l.entities.camera.following&&(l.entities.camera.shaking=!1)},b)};l.grid={};l.grid.database={};l.grid.make=function(a,b,c){l.grid.width=a;l.grid.height=b;for(a=0;a<l.grid.height+1;a++)for(b=0;b<l.grid.width+1;b++)b<l.grid.width&&a<l.grid.height&&(l.grid.database["row"+a]||(l.grid.database["row"+a]={}),l.grid.database["row"+a]["column"+b]||(l.grid.database["row"+a]["column"+b]={}),l.grid.database["row"+a]["column"+b].x=0-l.grid.width/2*c+b*c,l.grid.database["row"+a]["column"+b].y=0-l.grid.height/2*c+a*c)};
l.grid.get=function(a,b,c){return("x"==c?l.canvas.width/2:l.canvas.height/2)+l.grid.database["row"+a]["column"+b][c]};l.entities={};l.object={};
l.object.make=function(a,b,c,d,e){l.entities[a]={};l.entities[a].x=b;l.entities[a].y=c;l.entities[a].width=d;l.entities[a].height=e;l.entities[a].bounding={};l.entities[a].bounding.x=b;l.entities[a].bounding.y=c;l.entities[a].bounding.offset={};l.entities[a].bounding.offset.x=0;l.entities[a].bounding.offset.y=0;l.entities[a].bounding.width=d;l.entities[a].bounding.height=e;l.entities[a].anchor={};l.entities[a].anchor.offset={};l.entities[a].anchor.offset.x=d/2;l.entities[a].anchor.offset.y=e/2;l.entities[a].anchor.x=
b+d/2;l.entities[a].anchor.y=c+e/2;l.entities[a].physics={};l.entities[a].physics.momentum={};l.entities[a].physics.momentum.x=0;l.entities[a].physics.momentum.y=0;l.entities[a].physics.momentum.total=0};l.object.categorize=function(a,b){l.entities[a].category=b};
l.object.sprite=function(a,b,c,d,e,f){l.preloader.queue();l.entities[a].sprite=new Image;l.entities[a].sprite.src=b;l.entities[a].animate={};l.entities[a].animate.width=c?c:l.entities[a].width;l.entities[a].animate.height=d?d:l.entities[a].height;e&&(l.entities[a].animate.count=e,l.entities[a].animate.frame=0);f&&(l.entities[a].animate.interval=l.object.animate(a,f));l.entities[a].sprite.onload=function(){l.preloader.update()}};
l.object.animate=function(a,b){setInterval(function(){l.entities[a].animate.frame=l.entities[a].animate.frame<l.entities[a].animate.count-1?l.entities[a].animate.frame+1:0},b)};l.object.anchor=function(a,b,c){l.entities[a].x-=b;l.entities[a].y-=c;l.entities[a].anchor.offset.x=b;l.entities[a].anchor.offset.y=c;l.object.update(a)};l.object.bounding=function(a,b,c,d,e){l.entities[a].bounding.offset.x=b;l.entities[a].bounding.offset.y=c;l.entities[a].bounding.width=d;l.entities[a].bounding.height=e;l.object.update(a)};
l.object.update=function(a){l.entities[a].anchor.x=l.entities[a].x+l.entities[a].anchor.offset.x;l.entities[a].anchor.y=l.entities[a].y+l.entities[a].anchor.offset.y;l.entities[a].bounding.x=l.entities[a].x+l.entities[a].bounding.offset.x;l.entities[a].bounding.y=l.entities[a].y+l.entities[a].bounding.offset.y};l.object["delete"]=function(a){if(l.entities[a])delete l.entities[a];else for(var b in l.entities)l.entities[b].category==a&&l.object["delete"](b)};l.object.last={};
l.object.from=function(a,b,c){l.object.last[a]||(l.object.last[a]=0);var d=l.object.last[a]+1;l.object.last[a]=d;l.prototype.entities[a]&&(l.entities[a+d]={},l.entities[a+d].prototype=a,l.entities[a+d].x=b-l.prototype.entities[a].anchor.offset.x,l.entities[a+d].y=c-l.prototype.entities[a].anchor.offset.y,l.entities[a+d].width=l.prototype.entities[a].width,l.entities[a+d].height=l.prototype.entities[a].height,l.entities[a+d].bounding={},l.entities[a+d].bounding.x=b,l.entities[a+d].bounding.y=c,l.entities[a+
d].bounding.offset={},l.entities[a+d].bounding.offset.x=l.prototype.entities[a].bounding.offset.x,l.entities[a+d].bounding.offset.y=l.prototype.entities[a].bounding.offset.y,l.entities[a+d].bounding.width=l.prototype.entities[a].width,l.entities[a+d].bounding.height=l.prototype.entities[a].height,l.entities[a+d].anchor={},l.entities[a+d].anchor.offset={},l.entities[a+d].anchor.offset.x=l.prototype.entities[a].anchor.offset.x,l.entities[a+d].anchor.offset.y=l.prototype.entities[a].anchor.offset.y,
l.entities[a+d].anchor.x=b,l.entities[a+d].anchor.y=c,l.entities[a+d].physics={},l.entities[a+d].physics.momentum={},l.entities[a+d].physics.momentum.x=l.prototype.entities[a].physics.momentum.x,l.entities[a+d].physics.momentum.y=l.prototype.entities[a].physics.momentum.y,l.entities[a+d].physics.momentum.total=l.prototype.entities[a].physics.momentum.total,l.prototype.entities[a].category&&(l.entities[a+d].category=l.prototype.entities[a].category),l.prototype.entities[a].sprite&&(l.entities[a+d].sprite=
l.prototype.entities[a].sprite),l.prototype.entities[a].animate&&(l.entities[a+d].animate={},l.entities[a+d].animate.width=l.prototype.entities[a].animate.width,l.entities[a+d].animate.height=l.prototype.entities[a].animate.height,l.entities[a+d].animate.count=l.prototype.entities[a].animate.count,l.entities[a+d].animate.frame=l.prototype.entities[a].animate.frame,l.prototype.entities[a].animate.timer&&(l.prototype.entities[a].animate.interval=l.object.animate(a,timer))))};l.prototype={};l.prototype.entities={};
l.prototype.make=function(a,b,c){l.prototype.entities[a]={};l.prototype.entities[a].width=b;l.prototype.entities[a].height=c;l.prototype.entities[a].bounding={};l.prototype.entities[a].bounding.x=0;l.prototype.entities[a].bounding.y=0;l.prototype.entities[a].bounding.offset={};l.prototype.entities[a].bounding.offset.x=0;l.prototype.entities[a].bounding.offset.y=0;l.prototype.entities[a].bounding.width=b;l.prototype.entities[a].bounding.height=c;l.prototype.entities[a].anchor={};l.prototype.entities[a].anchor.offset=
{};l.prototype.entities[a].anchor.offset.x=b/2;l.prototype.entities[a].anchor.offset.y=c/2;l.prototype.entities[a].anchor.x=b/2;l.prototype.entities[a].anchor.y=c/2;l.prototype.entities[a].physics={};l.prototype.entities[a].physics.momentum={};l.prototype.entities[a].physics.momentum.x=0;l.prototype.entities[a].physics.momentum.y=0;l.prototype.entities[a].physics.momentum.total=0};l.prototype.categorize=function(a,b){l.prototype.entities[a].category=b};
l.prototype.sprite=function(a,b,c,d,e,f){l.preloader.queue();l.prototype.entities[a].sprite=new Image;l.prototype.entities[a].sprite.src=b;l.prototype.entities[a].animate={};l.prototype.entities[a].animate.width=c?c:l.prototype.entities[a].width;l.prototype.entities[a].animate.height=d?d:l.prototype.entities[a].height;e&&(l.prototype.entities[a].animate.count=e,l.prototype.entities[a].animate.frame=0);f&&(l.prototype.entities[a].animate.timer=f);l.prototype.entities[a].sprite.onload=function(){l.preloader.update()}};
l.prototype.anchor=function(a,b,c){l.prototype.entities[a].x-=b;l.prototype.entities[a].y-=c;l.prototype.entities[a].anchor.offset.x=b;l.prototype.entities[a].anchor.offset.y=c;l.prototype.update(a)};l.prototype.bounding=function(a,b,c,d,e){l.prototype.entities[a].bounding.offset.x=b;l.prototype.entities[a].bounding.offset.y=c;l.prototype.entities[a].bounding.width=d;l.prototype.entities[a].bounding.height=e;l.prototype.update(a)};
l.prototype.update=function(a){l.prototype.entities[a].anchor.x=l.prototype.entities[a].anchor.offset.x;l.prototype.entities[a].anchor.y=l.prototype.entities[a].anchor.offset.y;l.prototype.entities[a].bounding.x=l.prototype.entities[a].bounding.offset.x;l.prototype.entities[a].bounding.y=l.prototype.entities[a].bounding.offset.y};l.tool={};l.tool.random=function(a,b){return Math.random()*(b-a)+a};l.tool.count={};l.tool.count.all=function(){var a=0,b;for(b in l.entities)a++;return a};l.tool.count.prototype=function(a){var b=0,c;for(c in l.entities)l.entities[c].prototype==a&&b++;return b};l.tool.count.category=function(a){var b=0,c;for(c in l.entities)l.entities[c].category==a&&b++;return b};l.tool.measure={};
l.tool.measure.x=function(a,b){return l.entities[a]&&l.entities[b]?Math.floor(Math.abs(l.entities[a].anchor.x-l.entities[b].anchor.x)):Math.floor(Math.abs(l.entities[a].anchor.x-b))};l.tool.measure.y=function(a,b){return l.entities[a]&&l.entities[b]?Math.floor(Math.abs(l.entities[a].anchor.y-l.entities[b].anchor.y)):Math.floor(Math.abs(l.entities[a].anchor.y-b))};
l.tool.measure.total=function(a,b,c){if(l.entities[a]&&l.entities[b]){var d=l.tool.measure.x(a,b);a=l.tool.measure.y(a,b)}else d=l.tool.measure.x(a,b),a=l.tool.measure.y(a,c);return Math.floor(Math.sqrt(d*d+a*a))};l.tool.convert={};l.tool.convert.radian=function(a){return 180*a/Math.PI};l.tool.convert.degree=function(a){return a*Math.PI/180};l.gamecenter={};l.gamecenter.socket=new Ejecta.GameCenter;l.gamecenter.authed=!1;l.gamecenter.login={};l.gamecenter.login.soft=function(){l.gamecenter.socket.softAuthenticate(function(a){a?l.debug.gamecenter&&console.log("GameCenter soft login failed"):(l.gamecenter.authed=!0,l.debug.gamecenter&&console.log("GameCenter soft login succeeded"))})};
l.gamecenter.login.hard=function(){l.gamecenter.socket.authenticate(function(a){a?l.debug.gamecenter&&console.log("GameCenter hard login failed"):(l.gamecenter.authed=!0,l.debug.gamecenter&&console.log("GameCenter hard login succeeded"))})};l.gamecenter.submit={};l.gamecenter.submit.score=function(a,b){l.gamecenter.socket.reportScore(a,b,function(c){c?l.debug.gamecenter&&console.log("Reporting of "+b+" to "+a+" failed"):l.debug.gamecenter&&console.log("Reporting of "+b+" to "+a+" succeeded")})};
l.gamecenter.show={};l.gamecenter.show.leaderboard=function(a){l.gamecenter.socket.showLeaderboard(a);l.debug.gamecenter&&console.log("Opened "+a+" leaderboard")};l.ad={};l.ad.banner={};l.ad.banner.socket=new Ejecta.AdBanner;l.ad.banner.show=function(a){l.ad.banner.socket.alwaysPortrait=!1;l.ad.banner.socket.isAtBottom="top"==a?!1:!0;l.ad.banner.socket.show()};l.ad.banner.hide=function(){l.ad.banner.socket.hide()};l.collision=function(a,b,c){if(l.entities[a]&&l.entities[b])if(l.entities[a].bounding.x<l.entities[b].bounding.x+l.entities[b].bounding.width&&l.entities[a].bounding.x+l.entities[a].bounding.width>l.entities[b].bounding.x&&l.entities[a].bounding.y<l.entities[b].bounding.y+l.entities[b].bounding.height&&l.entities[a].bounding.y+l.entities[a].bounding.height>l.entities[b].bounding.y)if(c)eval(c);else return!0;else return!1;else if(l.entities[a])for(var d in l.entities)l.entities[d].category==b&&l.collision(a,
d,c);else if(l.entities[b])for(d in l.entities)l.entities[d].category==a&&l.collision(d,b,c);else for(d in l.entities)if(l.entities[d].category==a)for(var e in l.entities)l.entities[e].category==b&&l.collision(d,e,c)};l.buffer={};l.buffer.database=[];l.buffer.object=function(a,b){if(l.entities[a]){var c={};c.name=a;c.y=l.entities[a].anchor.y;c.flipped=b;l.buffer.database.push(c)}else for(c in l.entities)l.entities[c].category==a&&l.buffer.object(c,b)};l.draw={};l.draw.blank=function(a){l.ctx.fillStyle=a?a:l.entities.camera.color;l.ctx.fillRect(0,0,l.entities.camera.width,l.entities.camera.height)};
l.draw.rectangle=function(a,b,c,d,e,f){Math.round(a+c)>Math.round(l.entities.camera.x)&&Math.round(a)<Math.round(l.entities.camera.x+l.entities.camera.width)&&Math.round(b+d)>Math.round(l.entities.camera.y)&&Math.round(b)<Math.round(l.entities.camera.y+l.entities.camera.height)&&(f&&(l.ctx.globalAlpha=f),l.ctx.fillStyle=e,l.ctx.fillRect(Math.round(a-l.entities.camera.x),Math.round(b-l.entities.camera.y),c,d),f&&(l.ctx.globalAlpha=1))};
l.draw.objects=function(){l.buffer.database.sort(function(a,c){return a.y-c.y});for(var a=0;a<l.buffer.database.length;a++)Math.round(l.entities[l.buffer.database[a].name].x+l.entities[l.buffer.database[a].name].width)>Math.round(l.entities.camera.x)&&Math.round(l.entities[l.buffer.database[a].name].x)<Math.round(l.entities.camera.x+l.entities.camera.width)&&Math.round(l.entities[l.buffer.database[a].name].y+l.entities[l.buffer.database[a].name].height)>Math.round(l.entities.camera.y)&&Math.round(l.entities[l.buffer.database[a].name].y)<
Math.round(l.entities.camera.y+l.entities.camera.height)&&(l.buffer.database[a].flipped?(l.ctx.save(),"horizontal"==l.buffer.database[a].flipped?(l.ctx.translate(Math.round(l.entities[l.buffer.database[a].name].x+l.entities[l.buffer.database[a].name].width-l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y-l.entities.camera.y)),l.ctx.scale(-1,1)):"vertical"==l.buffer.database[a].flipped?(l.ctx.translate(Math.round(l.entities[l.buffer.database[a].name].x-l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y+
l.entities[l.buffer.database[a].name].height-l.entities.camera.y)),l.ctx.scale(1,-1)):"both"==l.buffer.database[a].flipped&&(l.ctx.translate(Math.round(l.entities[l.buffer.database[a].name].x+l.entities[l.buffer.database[a].name].width-l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y+l.entities[l.buffer.database[a].name].height-l.entities.camera.y)),l.ctx.scale(-1,-1)),l.entities[l.buffer.database[a].name].animate.count?l.ctx.drawImage(l.entities[l.buffer.database[a].name].sprite,
l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count*l.entities[l.buffer.database[a].name].animate.frame,0,l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count,l.entities[l.buffer.database[a].name].animate.height,0,0,l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count,l.entities[l.buffer.database[a].name].animate.height):l.ctx.drawImage(l.entities[l.buffer.database[a].name].sprite,
0,0),l.ctx.restore()):l.entities[l.buffer.database[a].name].animate.count?l.ctx.drawImage(l.entities[l.buffer.database[a].name].sprite,l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count*l.entities[l.buffer.database[a].name].animate.frame,0,l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count,l.entities[l.buffer.database[a].name].animate.height,Math.round(l.entities[l.buffer.database[a].name].x-
l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y-l.entities.camera.y),l.entities[l.buffer.database[a].name].animate.width/l.entities[l.buffer.database[a].name].animate.count,l.entities[l.buffer.database[a].name].animate.height):l.ctx.drawImage(l.entities[l.buffer.database[a].name].sprite,Math.round(l.entities[l.buffer.database[a].name].x-l.entities.camera.x),Math.round(l.entities[l.buffer.database[a].name].y-l.entities.camera.y)),(l.debug.anchor||l.debug.all)&&l.draw.rectangle(l.entities[l.buffer.database[a].name].anchor.x,
l.entities[l.buffer.database[a].name].anchor.y,1,1,"#ffff00"),(l.debug.bounding||l.debug.all)&&l.draw.rectangle(l.entities[l.buffer.database[a].name].x+l.entities[l.buffer.database[a].name].bounding.offset.x,l.entities[l.buffer.database[a].name].y+l.entities[l.buffer.database[a].name].bounding.offset.y,l.entities[l.buffer.database[a].name].bounding.width,l.entities[l.buffer.database[a].name].bounding.height,"#00ff00",0.5),(l.debug.names||l.debug.all)&&l.write.text(l.buffer.database[a].name,l.entities[l.buffer.database[a].name].x+
l.entities[l.buffer.database[a].name].width,l.entities[l.buffer.database[a].name].y,null,null,"#FF0000"),(l.debug.position||l.debug.all)&&l.draw.rectangle(l.entities[l.buffer.database[a].name].x,l.entities[l.buffer.database[a].name].y,1,1,"#0000ff"));l.buffer.database.length=0};
l.draw.hud=function(a,b){if(l.entities[a])b?(l.ctx.save(),"horizontal"==b?(l.ctx.translate(Math.round(l.entities[a].x+l.entities[a].width),Math.round(l.entities[a].y)),l.ctx.scale(-1,1)):"vertical"==b?(l.ctx.translate(Math.round(l.entities[a].x),Math.round(l.entities[a].y+l.entities[a].height)),l.ctx.scale(1,-1)):"both"==b&&(l.ctx.translate(Math.round(l.entities[a].x+l.entities[a].width),Math.round(l.entities[a].y+l.entities[a].height)),l.ctx.scale(-1,-1)),l.entities[a].animate.count?l.ctx.drawImage(l.entities[a].sprite,
l.entities[a].animate.width/l.entities[a].animate.count*l.entities[a].animate.frame,0,l.entities[a].animate.width/l.entities[a].animate.count,l.entities[a].animate.height,0,0,l.entities[a].animate.width/l.entities[a].animate.count,l.entities[a].animate.height):l.ctx.drawImage(l.entities[a].sprite,0,0),l.ctx.restore()):l.entities[a].animate.count?l.ctx.drawImage(l.entities[a].sprite,l.entities[a].animate.width/l.entities[a].animate.count*l.entities[a].animate.frame,0,l.entities[a].animate.width/l.entities[a].animate.count,
l.entities[a].animate.height,Math.round(l.entities[a].x),Math.round(l.entities[a].y),l.entities[a].animate.width/l.entities[a].animate.count,l.entities[a].animate.height):l.ctx.drawImage(l.entities[a].sprite,Math.round(l.entities[a].x),Math.round(l.entities[a].y));else for(var c in l.entities)l.entities[c].category==a&&l.draw.hud(c,b)};l.keyboard={};l.keyboard.enable=function(){document.body.setAttribute("onkeydown","l.keyboard.pressed(event)");document.body.setAttribute("onkeyup","l.keyboard.cancel(event)")};
l.keyboard.pressed=function(a){27==a.keyCode&&(l.keyboard.escape=!0);32==a.keyCode&&(l.keyboard.space=!0);13==a.keyCode&&(l.keyboard.enter=!0);16==a.keyCode&&(l.keyboard.shift=!0);65==a.keyCode&&(l.keyboard.a=!0);83==a.keyCode&&(l.keyboard.s=!0);38==a.keyCode&&(l.keyboard.up=!0);40==a.keyCode&&(l.keyboard.down=!0);37==a.keyCode&&(l.keyboard.left=!0);39==a.keyCode&&(l.keyboard.right=!0);if(l.debug.keyboard||l.debug.all)l.keyboard.escape&&console.log("Escape"),l.keyboard.space&&console.log("Space"),
l.keyboard.enter&&console.log("Enter"),l.keyboard.shift&&console.log("Shift"),l.keyboard.a&&console.log("A"),l.keyboard.s&&console.log("S"),l.keyboard.up&&console.log("Up"),l.keyboard.down&&console.log("Down"),l.keyboard.left&&console.log("Left"),l.keyboard.right&&console.log("Right")};
l.keyboard.cancel=function(a){27==a.keyCode&&(l.keyboard.escape=!1);32==a.keyCode&&(l.keyboard.space=!1);13==a.keyCode&&(l.keyboard.enter=!1);16==a.keyCode&&(l.keyboard.shift=!1);65==a.keyCode&&(l.keyboard.a=!1);83==a.keyCode&&(l.keyboard.s=!1);38==a.keyCode&&(l.keyboard.up=!1);40==a.keyCode&&(l.keyboard.down=!1);37==a.keyCode&&(l.keyboard.left=!1);39==a.keyCode&&(l.keyboard.right=!1)};
l.keyboard.clear=function(){l.keyboard.escape=!1;l.keyboard.space=!1;l.keyboard.enter=!1;l.keyboard.shift=!1;l.keyboard.a=!1;l.keyboard.s=!1;l.keyboard.up=!1;l.keyboard.down=!1;l.keyboard.left=!1;l.keyboard.right=!1};l.mouse={};l.mouse.clicks={};l.mouse.enable=function(){document.onmousemove=l.mouse.moved;l.dom.setAttribute("onmousedown","l.mouse.clicked(event)");l.dom.setAttribute("onmouseup","l.mouse.cancel()")};l.mouse.moved=function(a){if(a){l.mouse.x=a.clientX-l.dom.offsetLeft+l.entities.camera.x;l.mouse.y=a.clientY-l.dom.offsetTop+l.entities.camera.y;if(0>l.mouse.x||l.mouse.x>l.camera.width||0>l.mouse.y||l.mouse.y>l.camera.height)l.mouse.x=null,l.mouse.y=null;l.mouse.debug()}};
l.mouse.clicked=function(a){a&&(l.mouse.clicked.x=a.x-l.dom.offsetLeft,l.mouse.clicked.y=a.y-l.dom.offsetTop,l.mouse.debug())};l.mouse.cancel=function(a){l.mouse.clicked.x=null;l.mouse.clicked.y=null;l.mouse.debug()};l.mouse.debug=function(){if(l.debug.mouse||l.debug.all)l.mouse.x&&l.mouse.y&&console.log("Mouse at X: "+l.mouse.x+" Y: "+l.mouse.y),l.mouse.clicked.x&&l.mouse.clicked.y&&console.log("Click at X: "+l.mouse.clicked.x+" Y: "+l.mouse.clicked.y)};l.move={};l.move.snap=function(a,b,c){if(l.entities[a])l.entities[a].x=l.entities[a].anchor.offset.x?b-l.entities[a].anchor.offset.x:b,l.entities[a].y=l.entities[a].anchor.offset.y?c-l.entities[a].anchor.offset.y:c,l.object.update(a);else for(var d=Object.keys(l.entities),e=0;e<d.length;e++)l.entities[d[e]].category==a&&l.move.snap(d[e],b,c)};
l.move.up=function(a,b){if(l.entities[a])l.entities[a].y-=b/60,l.object.update(a);else for(var c=Object.keys(l.entities),d=0;d<c.length;d++)l.entities[c[d]].category==a&&l.move.up(c[d],b)};l.move.down=function(a,b){if(l.entities[a])l.entities[a].y+=b/60,l.object.update(a);else for(var c=Object.keys(l.entities),d=0;d<c.length;d++)l.entities[c[d]].category==a&&l.move.down(c[d],b)};
l.move.left=function(a,b){if(l.entities[a])l.entities[a].x-=b/60,l.object.update(a);else for(var c=Object.keys(l.entities),d=0;d<c.length;d++)l.entities[c[d]].category==a&&l.move.left(c[d],b)};l.move.right=function(a,b){if(l.entities[a])l.entities[a].x+=b/60,l.object.update(a);else for(var c=Object.keys(l.entities),d=0;d<c.length;d++)l.entities[c[d]].category==a&&l.move.right(c[d],b)};
l.move.to=function(a,b,c,d){if(l.entities[a]){var e=l.tool.measure.x(a,b)/l.tool.measure.total(a,b,c)*d;d*=l.tool.measure.y(a,c)/l.tool.measure.total(a,b,c);0<l.tool.measure.total(a,b,c)&&(l.entities[a].anchor.x<b&&l.entities[a].anchor.y<c?(l.move.right(a,e),l.move.down(a,d)):l.entities[a].anchor.x>b&&l.entities[a].anchor.y<c?(l.move.left(a,e),l.move.down(a,d)):l.entities[a].anchor.x<b&&l.entities[a].anchor.y>c?(l.move.right(a,e),l.move.up(a,d)):l.entities[a].anchor.x>b&&l.entities[a].anchor.y>c&&
(l.move.left(a,e),l.move.up(a,d)))}else for(var e=Object.keys(l.entities),f=0;f<e.length;f++)l.entities[e[f]].category==a&&l.move.to(e[f],b,c,d)};
l.move.toward=function(a,b,c){if(l.entities[a]){var d=l.tool.measure.x(a,b)/l.tool.measure.total(a,b)*c;c*=l.tool.measure.y(a,b)/l.tool.measure.total(a,b);0<l.tool.measure.total(a,b)&&(l.entities[a].anchor.x<l.entities[b].anchor.x&&l.entities[a].anchor.y<l.entities[b].anchor.y?(l.move.right(a,d),l.move.down(a,c)):l.entities[a].anchor.x>l.entities[b].anchor.x&&l.entities[a].anchor.y<l.entities[b].anchor.y?(l.move.left(a,d),l.move.down(a,c)):l.entities[a].anchor.x<l.entities[b].anchor.x&&l.entities[a].anchor.y>
l.entities[b].anchor.y?(l.move.right(a,d),l.move.up(a,c)):l.entities[a].anchor.x>l.entities[b].anchor.x&&l.entities[a].anchor.y>l.entities[b].anchor.y&&(l.move.left(a,d),l.move.up(a,c)))}else for(var d=Object.keys(l.entities),e=0;e<d.length;e++)l.entities[d[e]].category==a&&l.move.toward(d[e],b,c)};l.physics={};l.game.physics={};
l.physics.update=function(a){if(l.entities[a])l.entities[a].physics.momentum.total=Math.abs(l.entities[a].physics.momentum.x)+Math.abs(l.entities[a].physics.momentum.y),0!==l.entities[a].physics.momentum.x&&(0>l.entities[a].physics.momentum.x?(l.move.left(a,Math.abs(l.entities[a].physics.momentum.x)),l.entities[a].physics.momentum.x+=l.game.physics.friction,0<l.entities[a].physics.momentum.x&&(l.entities[a].physics.momentum.x=0)):0<l.entities[a].physics.momentum.x&&(l.move.right(a,Math.abs(l.entities[a].physics.momentum.x)),
l.entities[a].physics.momentum.x-=l.game.physics.friction,0>l.entities[a].physics.momentum.x&&(l.entities[a].physics.momentum.x=0))),0!==l.entities[a].physics.momentum.y&&(0>l.entities[a].physics.momentum.y?(l.move.up(a,Math.abs(l.entities[a].physics.momentum.y)),l.entities[a].physics.momentum.y+=l.game.physics.friction,0<l.entities[a].physics.momentum.y&&(l.entities[a].physics.momentum.y=0)):0<l.entities[a].physics.momentum.y&&(l.move.down(a,Math.abs(l.entities[a].physics.momentum.y)),l.entities[a].physics.momentum.y-=
l.game.physics.friction,0>l.entities[a].physics.momentum.y&&(l.entities[a].physics.momentum.y=0)));else for(var b in l.entities)l.entities[b].category==a&&l.physics.update(b)};l.physics.friction=function(a){l.game.physics.friction=a};l.physics.momentum={};l.physics.momentum.stop=function(a){if(l.entities[a])l.entities[a].physics.momentum.x=0,l.entities[a].physics.momentum.y=0;else for(var b in l.entities)l.entities[b].category==a&&l.physics.momentum.stop(b)};
l.physics.momentum.transfer=function(a,b){l.entities[b].physics.momentum.x=l.entities[a].physics.momentum.x;l.entities[b].physics.momentum.y=l.entities[a].physics.momentum.y};l.physics.push={};l.physics.push.up=function(a,b){if(l.entities[a])l.entities[a].physics.momentum.y-=b;else for(var c in l.entities)l.entities[c].category==a&&l.physics.push.up(c,b)};
l.physics.push.down=function(a,b){if(l.entities[a])l.entities[a].physics.momentum.y+=b;else for(var c in l.entities)l.entities[c].category==a&&l.physics.push.down(c,b)};l.physics.push.left=function(a,b){if(l.entities[a])l.entities[a].physics.momentum.x-=b;else for(var c in l.entities)l.entities[c].category==a&&l.physics.push.left(c,b)};
l.physics.push.right=function(a,b){if(l.entities[a])l.entities[a].physics.momentum.x+=b;else for(var c in l.entities)l.entities[c].category==a&&l.physics.push.right(c,b)};l.physics.pull={};
l.physics.pull.to=function(a,b,c,d){if(l.entities[a]){var e=l.tool.measure.x(a,b)/l.tool.measure.total(a,b,c)*d;d*=l.tool.measure.y(a,c)/l.tool.measure.total(a,b,c);0<l.tool.measure.total(a,b,c)&&(l.entities[a].anchor.x<b&&l.entities[a].anchor.y<c?(l.physics.push.right(a,e),l.physics.push.down(a,d)):l.entities[a].anchor.x>b&&l.entities[a].anchor.y<c?(l.physics.push.left(a,e),l.physics.push.down(a,d)):l.entities[a].anchor.x<b&&l.entities[a].anchor.y>c?(l.physics.push.right(a,e),l.physics.push.up(a,
d)):l.entities[a].anchor.x>b&&l.entities[a].anchor.y>c&&(l.physics.push.left(a,e),l.physics.push.up(a,d)))}else for(e in l.entities)l.entities[e].category==a&&l.physics.pull.to(e,b,c,d)};
l.physics.pull.toward=function(a,b,c){if(l.entities[a]){var d=l.tool.measure.x(a,b)/l.tool.measure.total(a,b)*c;c*=l.tool.measure.y(a,b)/l.tool.measure.total(a,b);0<l.tool.measure.total(a,b)&&(l.entities[a].anchor.x<l.entities[b].anchor.x&&l.entities[a].anchor.y<l.entities[b].anchor.y?(l.physics.push.right(a,d),l.physics.push.down(a,c)):l.entities[a].anchor.x>l.entities[b].anchor.x&&l.entities[a].anchor.y<l.entities[b].anchor.y?(l.physics.push.left(a,d),l.physics.push.down(a,c)):l.entities[a].anchor.x<
l.entities[b].anchor.x&&l.entities[a].anchor.y>l.entities[b].anchor.y?(l.physics.push.right(a,d),l.physics.push.up(a,c)):l.entities[a].anchor.x>l.entities[b].anchor.x&&l.entities[a].anchor.y>l.entities[b].anchor.y&&(l.physics.push.left(a,d),l.physics.push.up(a,c)))}else for(d in l.entities)l.entities[d].category==a&&l.physics.pull.toward(d,b,c)};l.physics.scatter=function(a,b){l.physics.push.up(a,l.tool.random(-b,b));l.physics.push.right(a,l.tool.random(-b,b))};
l.physics.bounce=function(a,b,c,d,e){b||c||d||e||(b=0,c=l.canvas.width,d=0,e=l.canvas.height);if(l.entities[a])l.entities[a].x<=b?(l.entities[a].x=b,l.entities[a].physics.momentum.x=-l.entities[a].physics.momentum.x):l.entities[a].x+l.entities[a].width>=c&&(l.entities[a].x=c-l.entities[a].width,l.entities[a].physics.momentum.x=-l.entities[a].physics.momentum.x),l.entities[a].y<=d?(l.entities[a].y=d,l.entities[a].physics.momentum.y=-l.entities[a].physics.momentum.y):l.entities[a].y+l.entities[a].height>=
e&&(l.entities[a].y=e-l.entities[a].height,l.entities[a].physics.momentum.y=-l.entities[a].physics.momentum.y);else for(var f in l.entities)l.entities[f].category==a&&l.physics.bounce(f,b,c,d,e)};l.preloader={};l.preloader.calculate=function(){l.preloader.percent=Math.round(100*(1-l.preloader.count/l.preloader.total))};l.preloader.queue=function(){l.preloader.count?(l.preloader.total+=1,l.preloader.count+=1):(l.preloader.total=1,l.preloader.count=1);l.preloader.calculate()};l.preloader.update=function(){l.preloader.count?(l.preloader.count-=1,l.preloader.calculate(),0==l.preloader.count&&l.change.screen(l.screen.engine.start)):l.change.screen(l.screen.engine.start)};l.write={};l.write.hud=function(a,b,c,d,e,f,g){l.ctx.font=d?(e+"px "+d).toString():"10px sans-serif";l.ctx.fillStyle=f?f:"#000000";g?"left"==g?l.ctx.textAlign="left":"right"==g?l.ctx.textAlign="right":"center"==g&&(l.ctx.textAlign="center"):l.ctx.textAlign="left";e?l.ctx.fillText(a,b,c+e):l.ctx.fillText(a,b,c+10)};
l.write.text=function(a,b,c,d,e,f,g){l.ctx.font=d?(e+"px "+d).toString():"10px sans-serif";l.ctx.fillStyle=f?f:"#000000";g?"left"==g?l.ctx.textAlign="left":"right"==g?l.ctx.textAlign="right":"center"==g&&(l.ctx.textAlign="center"):l.ctx.textAlign="left";e?l.ctx.fillText(a,b-l.entities.camera.x,c+e-l.entities.camera.y):l.ctx.fillText(a,b-l.entities.camera.x,c+10-l.entities.camera.y)};l.tilt={};l.tilt.x=0;l.tilt.y=0;l.tilt.z=0;l.tilt.enable=function(){document.addEventListener("deviceorientation",function(a){l.tilt.x=a.beta;l.tilt.y=a.alpha;l.tilt.z=a.gamma;l.tilt.debug()},!0)};l.tilt.debug=function(){l.debug.tilt&&console.log("x: "+l.tilt.x+" y: "+l.tilt.y+" z: "+l.tilt.z)};l.touch={};l.touch.database=[];l.touch.enable=function(){document.addEventListener("touchstart",function(a){l.touch.touches(a)});document.addEventListener("touchmove",function(a){l.touch.touches(a)});document.addEventListener("touchend",function(a){l.touch.touches(a)});document.addEventListener("touchcancel",function(a){l.touch.touches(a)})};l.touch.touches=function(a){a?(l.touch.database=a.touches,l.touch.debug()):l.touch.database.length=0};
l.touch.touched=function(a){if(0<l.touch.database.length)for(var b=0;b<l.touch.database.length;b++){if(l.touch.database[b].pageX<l.entities[a].bounding.x+l.entities[a].bounding.width&&l.touch.database[b].pageX>l.entities[a].bounding.x&&l.touch.database[b].pageY<l.entities[a].bounding.y+l.entities[a].bounding.height&&l.touch.database[b].pageY>l.entities[a].bounding.y)return(l.debug.all||l.debug.touches)&&console.log(a+" was touched"),!0;if(b==l.touch.database.length-1)return!1}};
l.touch.debug=function(){if(l.debug.all||l.debug.touches&&0<l.touch.database.length)for(var a=0;a<l.touch.database.length;a++)console.log("X"+a+": "+l.touch.database[a].pageX+" Y"+a+": "+l.touch.database[a].pageY)};